package emse;

import software.amazon.awssdk.regions.Region;
import software.amazon.awssdk.services.ec2.Ec2Client;
import software.amazon.awssdk.services.ec2.model.InstanceType;
import software.amazon.awssdk.services.ec2.model.RunInstancesRequest;
import software.amazon.awssdk.services.ec2.model.RunInstancesResponse;
import software.amazon.awssdk.services.ec2.model.CreateTagsRequest;

public class CreateInstance {
	

	public static void main(String name, String amiId) {
		
//		String name   = args[0];
//      String amiId  = args[1];
        Region region = Region.EU_WEST_3;
        Ec2Client ec2 = Ec2Client.builder()
                .region(region)
                .build();

        String instanceId = createEC2Instance(ec2,name, amiId) ;
        System.out.println("The EC2 Instance ID is "+ instanceId);
        ec2.close();
	}

	
	private static String createEC2Instance(Ec2Client ec2, String name, String amiId) {
		RunInstancesRequest runRequest = RunInstancesRequest.builder()
                .imageId(amiId)
                .instanceType(InstanceType.T1_MICRO)
                .maxCount(1)
                .minCount(1)
                .build();
		
		RunInstancesResponse response = ec2.runInstances(runRequest);
        String instanceId = response.instances().get(0).instanceId();
        
        CreateTagsRequest tagRequest = CreateTagsRequest.builder()
                .resources(instanceId)
                .build(); 
        
        return instanceId;
	}

	
	
}
